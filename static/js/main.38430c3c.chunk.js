(this["webpackJsonplottery-react-app"]=this["webpackJsonplottery-react-app"]||[]).push([[0],{215:function(e,t,n){},217:function(e,t,n){},230:function(e,t){},239:function(e,t){},257:function(e,t){},259:function(e,t){},275:function(e,t){},276:function(e,t){},341:function(e,t){},343:function(e,t){},375:function(e,t){},377:function(e,t){},378:function(e,t){},383:function(e,t){},385:function(e,t){},391:function(e,t){},393:function(e,t){},406:function(e,t){},418:function(e,t){},421:function(e,t){},426:function(e,t){},434:function(e,t){},509:function(e,t,n){"use strict";n.r(t);var a=n(65),s=n(204),r=n.n(s),i=(n(215),n(208)),c=n(15),o=n.n(c),l=n(29),u=n(6),d=n(7),p=n(12),b=n(11),y=(n(217),n(54)),h=n.n(y),m=(n(202),n(4)),x=new h.a(h.a.givenProvider),j=[{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"index",type:"uint256"},{indexed:!1,internalType:"address",name:"bettor",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"bytes1",name:"challenges",type:"bytes1"},{indexed:!1,internalType:"uint256",name:"answerBlockNumber",type:"uint256"}],name:"BET",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"index",type:"uint256"},{indexed:!1,internalType:"address",name:"bettor",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"bytes1",name:"challenges",type:"bytes1"},{indexed:!1,internalType:"bytes1",name:"answer",type:"bytes1"},{indexed:!1,internalType:"uint256",name:"answerBlockNumber",type:"uint256"}],name:"DRAW",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"index",type:"uint256"},{indexed:!1,internalType:"address",name:"bettor",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"bytes1",name:"challenges",type:"bytes1"},{indexed:!1,internalType:"bytes1",name:"answer",type:"bytes1"},{indexed:!1,internalType:"uint256",name:"answerBlockNumber",type:"uint256"}],name:"FAIL",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"index",type:"uint256"},{indexed:!1,internalType:"address",name:"bettor",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"bytes1",name:"challenges",type:"bytes1"},{indexed:!1,internalType:"uint256",name:"answerBlockNumber",type:"uint256"}],name:"REFUND",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"index",type:"uint256"},{indexed:!1,internalType:"address",name:"bettor",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"bytes1",name:"challenges",type:"bytes1"},{indexed:!1,internalType:"bytes1",name:"answer",type:"bytes1"},{indexed:!1,internalType:"uint256",name:"answerBlockNumber",type:"uint256"}],name:"WIN",type:"event"},{constant:!0,inputs:[],name:"answerForTest",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"owner",outputs:[{internalType:"address payable",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"bytes1",name:"challenges",type:"bytes1"}],name:"betAndDistribute",outputs:[{internalType:"bool",name:"result",type:"bool"}],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[],name:"getPot",outputs:[{internalType:"uint256",name:"_pot",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"bytes1",name:"challenges",type:"bytes1"}],name:"bet",outputs:[{internalType:"bool",name:"result",type:"bool"}],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[],name:"distribute",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"answer",type:"bytes32"}],name:"setAnswerForTest",outputs:[{internalType:"bool",name:"result",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"bytes1",name:"challenges",type:"bytes1"},{internalType:"bytes32",name:"answer",type:"bytes32"}],name:"isMatch",outputs:[{internalType:"enum Lottery.BettingResult",name:"",type:"uint8"}],payable:!1,stateMutability:"pure",type:"function"},{constant:!0,inputs:[{internalType:"uint256",name:"index",type:"uint256"}],name:"getBetInfo",outputs:[{internalType:"uint256",name:"answerBlockNumber",type:"uint256"},{internalType:"address",name:"bettor",type:"address"},{internalType:"bytes1",name:"challenges",type:"bytes1"}],payable:!1,stateMutability:"view",type:"function"}],f=function(e){Object(p.a)(n,e);var t=Object(b.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).pollData=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getPot();case 2:return e.next=4,a.getBetEvents();case 4:return e.next=6,a.getWinEvents();case 6:return e.next=8,a.getFailEvents();case 8:a.makeFinalRecords();case 9:case"end":return e.stop()}}),e)}))),a.initWeb3=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.ethereum){e.next=12;break}return window.web3=new h.a(window.ethereum),e.prev=2,e.next=5,window.ethereum.enable();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log("User denied account access: ".concat(e.t0));case 10:e.next=13;break;case 12:window.web3?(console.log("Legacy Mode"),window.web3=new h.a(h.a.currentProvider)):console.log("Non-Ethereum browser detected. You should consider trying MetaMask!");case 13:return e.next=15,x.eth.getAccounts();case 15:return t=e.sent,a.account=t[0],a.lotteryContract=new x.eth.Contract(j,"0xEbf40311f2b6237b68139a2d2396F84C2c131671"),e.next=20,a.lotteryContract.methods.owner().call();case 20:e.sent;case 21:case"end":return e.stop()}}),e,null,[[2,7]])}))),a.getPot=Object(l.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.lotteryContract.methods.getPot().call();case 2:t=e.sent,console.log(t),n=x.utils.fromWei(t.toString(),"ether"),console.log(n),a.setState({pot:n});case 7:case"end":return e.stop()}}),e)}))),a.getBetEvents=Object(l.a)(o.a.mark((function e(){var t,n,s,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,a.lotteryContract.getPastEvents("BET",{fromBlock:0,toBlock:"latest"});case 3:for(n=e.sent,s=0;s<n.length;s++)(r={}).index=parseInt(n[s].returnValues.index,10).toString(),r.bettor=n[s].returnValues.bettor,r.betBlockNumber=n[s].blockNumber,r.targetBlockNumber=n[s].returnValues.answerBlockNumber.toString(),r.challenges=n[s].returnValues.challenges,r.win="Not Revealed",r.answer="0x00",t.unshift(r);a.setState({betRecords:t});case 6:case"end":return e.stop()}}),e)}))),a.getFailEvents=Object(l.a)(o.a.mark((function e(){var t,n,s,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,a.lotteryContract.getPastEvents("FAIL",{fromBlock:0,toBlock:"latest"});case 3:for(n=e.sent,s=0;s<n.length;s++)(r={}).index=parseInt(n[s].returnValues.index,10).toString(),r.answer=n[s].returnValues.answer,t.unshift(r);a.setState({failRecords:t});case 6:case"end":return e.stop()}}),e)}))),a.getWinEvents=Object(l.a)(o.a.mark((function e(){var t,n,s,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,a.lotteryContract.getPastEvents("WIN",{fromBlock:0,toBlock:"latest"});case 3:for(n=e.sent,s=0;s<n.length;s++)(r={}).index=parseInt(n[s].returnValues.index,10).toString(),r.amount=parseInt(n[s].returnValues.amount,10).toString(),t.unshift(r);a.setState({winRecords:t});case 6:case"end":return e.stop()}}),e)}))),a.makeFinalRecords=Object(l.a)(o.a.mark((function e(){var t,n,s,r,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=0,n=0,s=Object(i.a)(a.state.betRecords),r=0;r<a.state.betRecords.length;r+=1)for(c=0;c<a.state.betRecords.length;c+=1)console.log(a.state.winRecords.length),a.state.winRecords.length>0&&a.state.betRecords[c].index===a.state.winRecords[n].index?(s[c].win="WIN",s[c].answer=s[c].challenges,s[c].pot=x.utils.fromWei(a.state.winRecords[n].amount,"ether"),a.state.winRecords.length-1>n&&n++):a.state.failRecords.length>0&&a.state.betRecords[c].index===a.state.failRecords[t].index&&(s[c].win="FAIL",s[c].answer=a.state.failRecords[t].answer,s[c].pot=0,a.state.failRecords.length-1>t&&t++);a.setState({finalRecords:s});case 4:case"end":return e.stop()}}),e)}))),a.bet=Object(l.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.eth.getTransactionCount(a.account);case 2:t=e.sent,n="0x"+a.state.challenges[0].toLowerCase()+a.state.challenges[1].toLowerCase(),a.lotteryContract.methods.betAndDistribute(n).send({from:a.account,value:5e15,gas:3e5,nonce:t}).on("transactionHash",(function(e){console.log(e)}));case 5:case"end":return e.stop()}}),e)}))),a.onClickCard=function(e){a.setState({challenges:[a.state.challenges[1],e]})},a.getCard=function(e,t){var n="";return"A"===e&&(n="\ud83c\udca1"),"B"===e&&(n="\ud83c\udcb1"),"C"===e&&(n="\ud83c\udcc1"),"D"===e&&(n="\ud83c\udcd1"),Object(m.jsx)("button",{className:t,onClick:function(){a.onClickCard(e)},children:Object(m.jsxs)("div",{className:"card-body text-center",children:[Object(m.jsx)("h1",{className:"card-text",children:e}),Object(m.jsx)("p",{className:"card-text text-center",style:{fontSize:300},children:n}),Object(m.jsx)("p",{className:"card-text"})]})})},a.state={betRecords:[],winRecords:[],failRecords:[],pot:"0",challenges:["A","B"],finalRecords:[{bettor:"0xabcd",index:"0",challenges:"ab",answer:"ab",targetBlockAnswer:"10",pot:"0"}]},a}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initWeb3();case 2:return e.next=4,this.pollData();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(m.jsxs)("div",{className:"App",children:[Object(m.jsx)("div",{className:"container",children:Object(m.jsxs)("div",{className:"jumbotron",children:[Object(m.jsx)("h1",{children:"Ropsten Ethereum Lottery Platform"}),Object(m.jsx)("br",{}),Object(m.jsxs)("h2",{children:["Current Pot : ",this.state.pot]})]})}),Object(m.jsx)("div",{className:"container",children:Object(m.jsxs)("div",{className:"jumbotron",children:[Object(m.jsx)("h2",{className:"display-4",children:"Play Intructions:"}),Object(m.jsx)("p",{className:"lead",children:"Select two cards in the combination, if match, you will win the entire pot!"}),Object(m.jsx)("hr",{className:"my-4"}),Object(m.jsx)("p1",{children:"Click on the card to replace the second card and it will push forward to the first one if you click another card. "}),Object(m.jsx)("p",{children:"The system will then decide a winning card combination. If you match, you will win the entire pot. Else your bet will go to the pot. "}),Object(m.jsx)("p",{children:"Please note this selection process is completely random and your chance of winning is always 1/16."}),Object(m.jsx)("p",{children:"Each time bet is 0.05 Eth"}),Object(m.jsx)("br",{}),Object(m.jsx)("br",{}),Object(m.jsx)("h3",{children:"Your Bet"}),Object(m.jsx)("p",{style:{fontSize:50},children:Object(m.jsxs)("b",{children:[this.state.challenges[0]," ",this.state.challenges[1]," ",this.state.challenges[2]]})})]})}),Object(m.jsx)("div",{className:"container",children:Object(m.jsxs)("div",{className:"card-group",children:[this.getCard("A","card bg-primary"),this.getCard("B","card bg-warning"),this.getCard("C","card bg-danger"),this.getCard("D","card bg-success")]})}),Object(m.jsx)("br",{}),Object(m.jsx)("div",{children:Object(m.jsx)("button",{className:"btn btn-danger btn-lg",onClick:this.bet,children:"BET!"})}),Object(m.jsx)("br",{}),Object(m.jsx)("div",{className:"container",children:Object(m.jsxs)("table",{className:"table table-dark table-striped",children:[Object(m.jsx)("thead",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{children:"Index"}),Object(m.jsx)("th",{children:"Address"}),Object(m.jsx)("th",{children:"Challenges"}),Object(m.jsx)("th",{children:"Answer"}),Object(m.jsx)("th",{children:"Pot"}),Object(m.jsx)("th",{children:"Status"})]})}),Object(m.jsx)("tbody",{children:this.state.finalRecords.map((function(e,t){return Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:e.index}),Object(m.jsx)("td",{children:e.bettor}),Object(m.jsx)("td",{children:e.challenges}),Object(m.jsx)("td",{children:e.answer}),Object(m.jsx)("td",{children:e.pot}),Object(m.jsx)("td",{children:e.win})]},t)}))})]})})]})}}]),n}(a.Component);r.a.render(Object(m.jsx)(f,{}),document.getElementById("root"))}},[[509,1,2]]]);
//# sourceMappingURL=main.38430c3c.chunk.js.map